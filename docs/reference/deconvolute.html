<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Deconvolute bulk RNA-Seq using single-cell RNA-Seq signature — deconvolute • cellGeometry</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Deconvolute bulk RNA-Seq using single-cell RNA-Seq signature — deconvolute"><meta name="description" content="Deconvolution of bulk RNA-Seq using vector projection method with adjustable
compensation for spillover."><meta property="og:description" content="Deconvolution of bulk RNA-Seq using vector projection method with adjustable
compensation for spillover."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">cellGeometry</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.8</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/intro.html">Get Started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/algorithm.html">Mathematical Foundations</a></li>
    <li><a class="dropdown-item" href="../articles/visualization.html">Visualization Guide</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">All articles</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-tutorials" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Tutorials</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-tutorials"><li><a class="dropdown-item" href="../articles/intro.html">Quick Start Guide</a></li>
    <li><a class="dropdown-item" href="../articles/real_world.html">Real-World Application</a></li>
    <li><a class="dropdown-item" href="../articles/brain_atlas.html">Large-Scale: Brain Atlas</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Zaoqu-Liu/cellGeometry"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Deconvolute bulk RNA-Seq using single-cell RNA-Seq signature</h1>
      <small class="dont-index">Source: <a href="https://github.com/Zaoqu-Liu/cellGeometry/blob/HEAD/R/deconvolute.R" class="external-link"><code>R/deconvolute.R</code></a></small>
      <div class="d-none name"><code>deconvolute.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Deconvolution of bulk RNA-Seq using vector projection method with adjustable
compensation for spillover.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">deconvolute</span><span class="op">(</span></span>
<span>  <span class="va">mk</span>,</span>
<span>  <span class="va">test</span>,</span>
<span>  logged_bulk <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  count_space <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  comp_amount <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  group_comp_amount <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  weight_method <span class="op">=</span> <span class="st">"equal"</span>,</span>
<span>  adjust_comp <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  use_filter <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  arith_mean <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  convert_bulk <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  check_comp <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  npass <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  outlier_method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"var.e"</span>, <span class="st">"cooks"</span>, <span class="st">"rstudent"</span><span class="op">)</span>,</span>
<span>  outlier_cutoff <span class="op">=</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">outlier_method</span>, var.e <span class="op">=</span> <span class="fl">4</span>, cooks <span class="op">=</span> <span class="fl">1</span>, rstudent <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>  outlier_quantile <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  cores <span class="op">=</span> <span class="fl">1L</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-mk">mk<a class="anchor" aria-label="anchor" href="#arg-mk"></a></dt>
<dd><p>object of class 'cellMarkers'. See <code><a href="cellMarkers.html">cellMarkers()</a></code>.</p></dd>


<dt id="arg-test">test<a class="anchor" aria-label="anchor" href="#arg-test"></a></dt>
<dd><p>matrix of bulk RNA-Seq to be deconvoluted with genes in rows and
samples in columns. We recommend raw counts as input, but normalised data
can be provided, in which case set <code>logged_bulk = TRUE</code>.</p></dd>


<dt id="arg-logged-bulk">logged_bulk<a class="anchor" aria-label="anchor" href="#arg-logged-bulk"></a></dt>
<dd><p>Logical, whether log2 transformed bulk RNA-Seq data is
used as input in <code>test</code>.</p></dd>


<dt id="arg-count-space">count_space<a class="anchor" aria-label="anchor" href="#arg-count-space"></a></dt>
<dd><p>Logical, whether deconvolution is performed in count
space (as opposed to log2 space). Signature and test revert to count scale
by 2^ exponentiation during deconvolution.</p></dd>


<dt id="arg-comp-amount">comp_amount<a class="anchor" aria-label="anchor" href="#arg-comp-amount"></a></dt>
<dd><p>either a single value from 0-1 for the amount of
compensation or a numeric vector with the same length as the number of cell
subclasses to deconvolute.</p></dd>


<dt id="arg-group-comp-amount">group_comp_amount<a class="anchor" aria-label="anchor" href="#arg-group-comp-amount"></a></dt>
<dd><p>either a single value from 0-1 for the amount of
compensation for cell group analysis or a numeric vector with the same
length as the number of cell groups to deconvolute.</p></dd>


<dt id="arg-weights">weights<a class="anchor" aria-label="anchor" href="#arg-weights"></a></dt>
<dd><p>Optional vector of weights which affects how much each gene in
the gene signature matrix affects the deconvolution.</p></dd>


<dt id="arg-weight-method">weight_method<a class="anchor" aria-label="anchor" href="#arg-weight-method"></a></dt>
<dd><p>Optional. Choices include "none" or "equal" in which
gene weights are calculated so that each gene has equal weighting in the
vector projection; "equal" overrules any vector supplied by <code>weights</code>.</p></dd>


<dt id="arg-adjust-comp">adjust_comp<a class="anchor" aria-label="anchor" href="#arg-adjust-comp"></a></dt>
<dd><p>logical, whether to optimise <code>comp_amount</code> to prevent
negative cell proportion projections.</p></dd>


<dt id="arg-use-filter">use_filter<a class="anchor" aria-label="anchor" href="#arg-use-filter"></a></dt>
<dd><p>logical, whether to use denoised signature matrix.</p></dd>


<dt id="arg-arith-mean">arith_mean<a class="anchor" aria-label="anchor" href="#arg-arith-mean"></a></dt>
<dd><p>logical, whether to use arithmetic means (if available) for
signature matrix. Mainly useful with pseudo-bulk simulation.</p></dd>


<dt id="arg-convert-bulk">convert_bulk<a class="anchor" aria-label="anchor" href="#arg-convert-bulk"></a></dt>
<dd><p>either "ref" to convert bulk RNA-Seq to scRNA-Seq scaling
using reference data or "qqmap" using quantile mapping of the bulk to
scRNA-Seq datasets, or "none" (or <code>FALSE</code>) for no conversion.</p></dd>


<dt id="arg-check-comp">check_comp<a class="anchor" aria-label="anchor" href="#arg-check-comp"></a></dt>
<dd><p>logical, whether to analyse compensation values across
subclasses. See <code><a href="plot_comp.html">plot_comp()</a></code>.</p></dd>


<dt id="arg-npass">npass<a class="anchor" aria-label="anchor" href="#arg-npass"></a></dt>
<dd><p>Number of passes. If <code>npass</code> set to 2 or more this activates
removal of genes with excess variance of the residuals.</p></dd>


<dt id="arg-outlier-method">outlier_method<a class="anchor" aria-label="anchor" href="#arg-outlier-method"></a></dt>
<dd><p>Method for identifying outlying genes. Options are to
use the variance of the residuals for each genes, Cook's distance or
absolute Studentized residuals (see details).</p></dd>


<dt id="arg-outlier-cutoff">outlier_cutoff<a class="anchor" aria-label="anchor" href="#arg-outlier-cutoff"></a></dt>
<dd><p>Cutoff for removing genes which are outliers based on
method selected by <code>outlier_method</code>.</p></dd>


<dt id="arg-outlier-quantile">outlier_quantile<a class="anchor" aria-label="anchor" href="#arg-outlier-quantile"></a></dt>
<dd><p>Controls quantile for the cutoff for identifying
outliers for <code>outlier_method = "cook"</code> or <code>"rstudent"</code>.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>logical, whether to show messages.</p></dd>


<dt id="arg-cores">cores<a class="anchor" aria-label="anchor" href="#arg-cores"></a></dt>
<dd><p>Number of cores for parallelisation via <code><a href="https://rdrr.io/r/parallel/mclapply.html" class="external-link">parallel::mclapply()</a></code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list object of S3 class 'deconv' containing:</p>
<dl><dt>call</dt>
<dd><p>the matched call</p></dd>

<dt>mk</dt>
<dd><p>the original 'cellMarkers' class object</p></dd>

<dt>subclass</dt>
<dd><p>list object containing:</p><ul><li><p><code>output</code>, the amount of each subclass based purely on project
gene expression</p></li>
<li><p><code>percent</code>, the proportion of each subclass scaled as a percentage
so that the total amount across all subclasses adds to 100%</p></li>
<li><p><code>spillover</code>, the spillover matrix</p></li>
<li><p><code>compensation</code>, the mixed final compensation matrix which
incorporates <code>comp_amount</code></p></li>
<li><p><code>rawcomp</code>, the original unadjusted compensation matrix</p></li>
<li><p><code>comp_amount</code>, the final values for the amount of compensation
across each cell subclass after adjustment to prevent negative values</p></li>
<li><p><code>residuals</code>, residuals, that is gene expression minus fitted
values</p></li>
<li><p><code>var.e</code>, variance of weighted residuals for each gene</p></li>
<li><p><code>weights</code>, vector of weights</p></li>
<li><p><code>resvar</code>, \(s^2\) the estimate of the gene expression variance
for each sample</p></li>
<li><p><code>se</code>, standard errors of cell counts</p></li>
<li><p><code>hat</code>, diagonal elements of the hat matrix</p></li>
<li><p><code>removed</code>, vector of outlying genes removed during successive
passes</p></li>
</ul></dd>

<dt>group</dt>
<dd><p>similar list object to <code>subclass</code>, but with results for the
cell group analysis.</p></dd>

<dt>nest_output</dt>
<dd><p>alternative matrix of cell output results for each
subclass adjusted so that the cell outputs across subclasses are nested
as a proportion of cell group outputs.</p></dd>

<dt>nest_percent</dt>
<dd><p>alternative matrix of cell proportion results for each
subclass adjusted so that the percentages across subclasses are nested
within cell group percentages. The total percentage still adds to 100%.</p></dd>

<dt>comp_amount</dt>
<dd><p>original argument <code>comp_amount</code></p></dd>

<dt>comp_check</dt>
<dd><p>optional list element returned when <code>check_comp = TRUE</code></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Equal weighting of genes by setting <code>weight_method = "equal"</code> can help
devolution of subclusters whose signature genes have low expression. It is
enabled by default.</p>
<p>If a normalised (i.e. logged) bulk matrix is provided instead of raw counts,
then it is important that zero expression is true zero. For this reason we do
not recommend use of VST (variance stabilised transformed counts) which has a
variable offset.</p>
<p>Multipass deconvolution can be activated by setting <code>npass</code> to 2 or higher.
This is designed to remove genes which behave inconsistently due to noise in
either the sc or bulk datasets, which is increasingly likely if you have
larger signature geneset, i.e. if <code>nsubclass</code> is large. Or you may receive a
warning message "Detected genes with extreme residuals". Three methods are
available for identifying outlier genes (i.e. whose residuals are too noisy)
controlled by <code>outlier_method</code>:</p><ul><li><p><code>var.e</code>, this calculates the variance of the residuals across samples for
each gene. Genes whose variance of residuals are outliers based on Z-score
standardisation are removed during successive passes.</p></li>
<li><p><code>cooks</code>, this considers the deconvolution as if it were a regression and
applies Cook's distance to the residuals and the hat matrix. This seems to be
the most stringent method (removes fewest genes).</p></li>
<li><p><code>rstudent</code>, externally Studentized residuals are used.</p></li>
</ul><p>The cutoff specified by <code>outlier_cutoff</code> which is used to determine which
genes are outliers is very sensitive to the outlier method. With <code>var.e</code> the
variances are Z-score scaled. With Cook's distance it is typical to consider
a value of &gt;1 as fairly strong indication of an outlier, while 0.5 is
considered a possible outlier. With Studentized residuals, these are expected
to be on a t distribution scale. However, since gene expression itself does
not derive from a normal distribution, the errors and residuals are not
normally distributed either, which probably explains the need for a very high
cut-off. In practice the choice of settings seems to be dataset dependent.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="cellMarkers.html">cellMarkers()</a></code> <code><a href="updateMarkers.html">updateMarkers()</a></code> <code><a href="rstudent.deconv.html">rstudent.deconv()</a></code>
<code><a href="rstudent.deconv.html">cooks.distance.deconv()</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Myles Lewis</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/Zaoqu-Liu" class="external-link">Zaoqu Liu</a> and <a href="https://github.com/myles-lewis" class="external-link">Myles Lewis</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

