<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Single-cell mean log gene expression across cell types — scmean • cellGeometry</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Single-cell mean log gene expression across cell types — scmean"><meta name="description" content="Workhorse function which takes as input a scRNA-Seq gene expression matrix
such as embedded in a Seurat object, calculates log2(counts +1) and averages
gene expression over a vector specifying cell subclasses or cell types. Very
large matrices are handled by slicing rows into blocks to avoid excess memory
requirements."><meta property="og:description" content="Workhorse function which takes as input a scRNA-Seq gene expression matrix
such as embedded in a Seurat object, calculates log2(counts +1) and averages
gene expression over a vector specifying cell subclasses or cell types. Very
large matrices are handled by slicing rows into blocks to avoid excess memory
requirements."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">cellGeometry</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.8</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/intro.html">Get Started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/algorithm.html">Mathematical Foundations</a></li>
    <li><a class="dropdown-item" href="../articles/visualization.html">Visualization Guide</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">All articles</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-tutorials" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Tutorials</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-tutorials"><li><a class="dropdown-item" href="../articles/intro.html">Quick Start Guide</a></li>
    <li><a class="dropdown-item" href="../articles/real_world.html">Real-World Application</a></li>
    <li><a class="dropdown-item" href="../articles/brain_atlas.html">Large-Scale: Brain Atlas</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Zaoqu-Liu/cellGeometry"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Single-cell mean log gene expression across cell types</h1>
      <small class="dont-index">Source: <a href="https://github.com/Zaoqu-Liu/cellGeometry/blob/HEAD/R/scmean.R" class="external-link"><code>R/scmean.R</code></a></small>
      <div class="d-none name"><code>scmean.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Workhorse function which takes as input a scRNA-Seq gene expression matrix
such as embedded in a Seurat object, calculates log2(counts +1) and averages
gene expression over a vector specifying cell subclasses or cell types. Very
large matrices are handled by slicing rows into blocks to avoid excess memory
requirements.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">scmean</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">celltype</span>,</span>
<span>  FUN <span class="op">=</span> <span class="st">"logmean"</span>,</span>
<span>  postFUN <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  sliceMem <span class="op">=</span> <span class="fl">16</span>,</span>
<span>  cores <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  load_balance <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  use_future <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>matrix, sparse matrix or DelayedMatrix of raw counts with genes in
rows and cells in columns.</p></dd>


<dt id="arg-celltype">celltype<a class="anchor" aria-label="anchor" href="#arg-celltype"></a></dt>
<dd><p>a vector of cell subclasses or types whose length matches the
number of columns in <code>x</code>. It is coerced to a factor. <code>NA</code> are tolerated and
the matching columns in <code>x</code> are skipped.</p></dd>


<dt id="arg-fun">FUN<a class="anchor" aria-label="anchor" href="#arg-fun"></a></dt>
<dd><p>Character value or function for applying mean. When applied to a
matrix of count values, this must return a vector. Recommended options are
<code>"logmean"</code> (the default) or <code>"trimmean"</code>.</p></dd>


<dt id="arg-postfun">postFUN<a class="anchor" aria-label="anchor" href="#arg-postfun"></a></dt>
<dd><p>Optional function to be applied to whole matrix after mean has
been calculated, e.g. <code>log2s</code>.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical, whether to print messages.</p></dd>


<dt id="arg-slicemem">sliceMem<a class="anchor" aria-label="anchor" href="#arg-slicemem"></a></dt>
<dd><p>Max amount of memory in GB to allow for each subsetted count
matrix object. When <code>x</code> is subsetted by each cell subclass, if the amount
of memory would be above <code>sliceMem</code> then slicing is activated and the
subsetted count matrix is divided into chunks and processed separately.
This is indicated by addition of '...' in the timings. The limit is just
under 17.2 GB (2^34 / 1e9). At this level the subsetted matrix breaches the
long vector limit (&gt;2^31 elements).</p></dd>


<dt id="arg-cores">cores<a class="anchor" aria-label="anchor" href="#arg-cores"></a></dt>
<dd><p>Integer, number of cores to use for parallelisation using
<code>mclapply()</code>. Parallelisation is not available on windows. Warning:
parallelisation increases the memory requirement by multiples of
<code>sliceMem</code>. <code>cores</code> is ignored if <code>use_future = TRUE</code>.</p></dd>


<dt id="arg-load-balance">load_balance<a class="anchor" aria-label="anchor" href="#arg-load-balance"></a></dt>
<dd><p>Logical, whether to load balance memory requirements
across cores (experimental).</p></dd>


<dt id="arg-use-future">use_future<a class="anchor" aria-label="anchor" href="#arg-use-future"></a></dt>
<dd><p>Logical, whether to use the future backend for
parallelisation via <code>future_lapply()</code> instead of the default which is
<code>mclapply()</code>. Note, the <code>future.apply</code> package needs to be installed to
enable this.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>a matrix of mean log2 gene expression across cell types with genes
in rows and cell types in columns.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Mean functions which can be applied by setting <code>FUN</code> include <code>logmean</code> (the
default) which applies row means to log2(counts+1), or <code>trimmean</code> which
calculates the trimmed mean of the counts after top/bottom 5% of values have
been excluded. Alternatively <code>FUN = rowMeans</code> calculates the arithmetic mean
of counts.</p>
<p>If <code>FUN = trimmean</code> or <code>rowMeans</code>, <code>postFUN</code> needs to be set to <code>log2s</code> which
is a simple function which applies log2(x+1).</p>
<p><code>sliceMem</code> can be set lower on machines with less RAM, but this will slow the
analysis down. <code>cores</code> increases the theoretical amount of memory required to
around <code>cores * sliceMem</code> in GB. For example on a 64 GB machine, we find a
significant speed increase with <code>cores = 3L</code>. Above this level, there is a
risk that memory swap will slow down processing.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="scapply.html">scapply()</a></code> which is a more general version which can apply any
function to the matrix. <code><a href="logmean.html">logmean</a></code>,
<code><a href="logmean.html">trimmean</a></code> are options for controlling the type of
mean applied.</p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Myles Lewis</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/Zaoqu-Liu" class="external-link">Zaoqu Liu</a> and <a href="https://github.com/myles-lewis" class="external-link">Myles Lewis</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

